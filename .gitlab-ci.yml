stages:
  - build
  - test
  - deploy

cache:
  paths:
    - .gradle/
    - build/
  key: ${CI_COMMIT_REF_SLUG}

build:
  stage: build
  image: gradle:8.11.1-jdk21-alpine
  script:
    - chmod +x ./gradlew
    - ./gradlew build -x test  # ‚Üê –°–æ–±–∏—Ä–∞–µ–º JAR –Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
    - echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    - find . -name "*.jar" | head -10  # ‚Üê –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ —Å–æ–±—Ä–∞–ª–æ—Å—å
  artifacts:
    paths:
      - build/libs/  # ‚Üê –í—Å—è –ø–∞–ø–∫–∞ —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏
    expire_in: 1 days
  tags:
    - docker

test:
  stage: test
  image: gradle:8.11.1-jdk21-alpine
  script:
    - chmod +x ./gradlew
    - ./gradlew test
    - echo "‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!"
  tags:
    - docker

deploy:
  stage: deploy
  image: gradle:8.11.1-jdk21-alpine
  script:
    - echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π..."
    - echo "–°–æ–±—Ä–∞–Ω–Ω—ã–µ JAR —Ñ–∞–π–ª—ã:"
    - find build/libs/ -name "*.jar" | head -10
    - ls -la build/libs/
    - echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
  tags:
    - docker
  only:
    - main
    - master
  dependencies:
    - build