stages:
  - build
  - test
  - deploy

cache:
  paths:
    - .gradle/
    - build/

build:
  stage: build
  image: gradle:jdk17-alpine
  script:
    - chmod +x ./gradlew
    - ./gradlew compileJava
    - echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
  artifacts:
    paths:
      - build/libs/*.jar
    expire_in: 1 week
  tags:
    - docker

test:
  stage: test
  image: gradle:jdk17-alpine
  script:
    - chmod +x ./gradlew
    - ./gradlew test
    - echo "‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!"
  tags:
    - docker

deploy:
  stage: deploy
  image: alpine:latest
  script:
    - echo "üöÄ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
    - echo "–°–æ–±—Ä–∞–Ω–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:"
    - find build/libs/ -name "*.jar" | head -5
  tags:
    - docker
  only:
    - main
    - master